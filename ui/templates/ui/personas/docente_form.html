{% extends "ui/base.html" %}

{% block content %}
<div class="rounded-2xl border border-slate-200 bg-white p-5">
  <div class="mb-6 flex items-center justify-between">
    <div>
      <h1 class="text-xl font-semibold tracking-tight">Nuevo Docente</h1>
      <p class="text-sm text-slate-500">Completa los datos básicos del docente.</p>
    </div>
  </div>

  <form method="post" enctype="multipart/form-data" class="space-y-6">
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="rounded-xl border border-red-200 bg-red-50 p-3 text-red-700">
        {{ form.non_field_errors }}
      </div>
    {% endif %}

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Columna principal (campos comunes) -->
      <div class="lg:col-span-2">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          {% for field in form %}
            {% if field.field.widget.input_type != 'file' %}
              <div>
                <label class="block text-sm font-medium mb-1">{{ field.label }}</label>
                {{ field }}
                {% if field.errors %}
                  <p class="text-xs text-red-600 mt-1">{{ field.errors|striptags }}</p>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- Columna foto (si hay FileField) -->
      <div>
        {% for field in form %}
          {% if field.field.widget.input_type == 'file' %}
            <div class="rounded-2xl border border-slate-200 p-4">
              <label class="block text-sm font-medium mb-2">{{ field.label|default:"Foto" }}</label>

              <div class="mb-3 flex items-center gap-3">
                <img id="previewFoto" alt="Vista previa" class="h-24 w-24 rounded-xl border border-slate-200 object-cover"
                     src="{% if field.value %}{{ field.value.url }}{% else %}https://via.placeholder.com/96x96.png?text=Foto{% endif %}">
                <div class="flex-1">
                  {{ field }}
                  {% if field.errors %}
                    <p class="text-xs text-red-600 mt-1">{{ field.errors|striptags }}</p>
                  {% endif %}
                  <p class="text-xs text-slate-500 mt-1">Formatos: JPG/PNG. Tamaño razonable.</p>
                </div>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <div class="mt-2 flex gap-2">
      <button class="px-4 py-2 rounded-xl bg-brand-500 text-white shadow-soft hover:bg-brand-600">
        Guardar
      </button>
      <a href="/docentes" class="px-4 py-2 rounded-xl border border-slate-200 bg-white">
        Cancelar
      </a>
    </div>
  </form>
</div>

<script>
  // preview de la foto (si existe input file)
  document.querySelectorAll('input[type=file]').forEach(function (inp) {
    inp.addEventListener('change', function () {
      const preview = document.getElementById('previewFoto');
      if (!preview) return;
      const [file] = inp.files || [];
      if (file) preview.src = URL.createObjectURL(file);
    });
  });
</script>
{% endblock %}