{% extends "base.html" %}

{% block title %}Panel de Administración{% endblock %}

{% block content %}
  <div class="row">
    <nav class="col-md-3 col-lg-2 d-md-block bg-white sidebar rounded-3 shadow-sm p-4">
      <div class="position-sticky">
        <h3 class="h5">Acciones</h3>
        <ul class="nav flex-column nav-pills">
          <li class="nav-item">
            <a href="?action=section_est" class="nav-link {% if action == 'section_est' or action == 'add_est' %}active{% endif %}">Estudiantes</a>
          </li>
          <li class="nav-item">
            <a href="?action=section_insc" class="nav-link {% if action == 'section_insc' or action == 'insc_prof' or action == 'insc_esp' or action == 'insc_final' %}active{% endif %}">Inscripciones</a>
          </li>
          <li class="nav-item">
            <a href="?action=section_calif" class="nav-link {% if action == 'section_calif' %}active{% endif %}">Calificaciones</a>
          </li>
          {% if can_admin %}
          <li class="nav-item">
            <a href="?action=section_admin" class="nav-link {% if action == 'section_admin' %}active{% endif %}">Administración</a>
          </li>
          {% endif %}
          <li class="nav-item">
            <a href="?action=section_help" class="nav-link {% if action == 'section_help' %}active{% endif %}">Ayuda</a>
          </li>
        </ul>
      </div>
    </nav>

    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div class="bg-white p-4 rounded-3 shadow-sm">
        <h2 class="h4">{{ action_title }}</h2>
        {% if action_subtitle %}<p class="text-muted">{{ action_subtitle|safe }}</p>{% endif %}

        {% if action == 'section_est' %}
          <ul class="list-unstyled">
            <li><a href="?action=add_est" class="btn btn-primary">➜ Nuevo estudiante</a></li>
          </ul>

        {% elif action == 'section_insc' %}
          <ul class="list-unstyled">
            <li><a href="?action=insc_prof" class="btn btn-primary">➜ Inscribir a carrera</a></li>
            <li class="mt-2"><a href="?action=insc_esp" class="btn btn-primary">➜ Inscribir a materia (cursada)</a></li>
          </ul>

        {% elif form %}
          <form method="post" enctype="multipart/form-data" action="?action={{ action }}" id="form-main">
            {% csrf_token %}
            <input type="hidden" name="action" value="{{ action }}">

            {% if form.non_field_errors %}
              <div class="alert alert-danger" role="alert">{{ form.non_field_errors }}</div>
            {% endif %}

            {% if form.errors %}
              <div class="alert alert-danger" role="alert">
                <strong>Por favor, corrige los errores:</strong>
                <ul class="mb-0">
                  {% for field in form %}
                    {% for error in field.errors %}
                      <li>{{ field.label }}: {{ error }}</li>
                    {% endfor %}
                  {% endfor %}
                </ul>
              </div>
            {% endif %}

            <div class="row g-3">
              {% for field in form %}
                <div class="col-md-6">
                  <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                  {{ field.as_widget }}
                  {% if field.help_text %}
                    <div class="form-text">{{ field.help_text }}</div>
                  {% endif %}
                </div>
              {% endfor %}
            </div>

            <div class="mt-4">
              <button type="submit" class="btn btn-success">Guardar</button>
              <a href="?" class="btn btn-secondary">Cancelar</a>
            </div>
          </form>
        {% endif %}
      </div>
    </main>
  </div>
{% endblock %}
